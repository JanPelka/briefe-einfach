<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>briefe-einfach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <style>
    :root{
      --bg1:#020617;
      --bg2:#0f172a;
      --card:#111827;
      --panel:#0b1220;
      --border:#1f2937;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --primary:#3b82f6;
      --danger:#ef4444;

      --radius:14px;
      --radius-sm:12px;

      --pad:24px;
      --gap:12px;

      --btn-h:44px;
      --btn-pad:14px;
      --font: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    *{ box-sizing:border-box; font-family:var(--font); }
    html,body{ height:100%; }
    body{
      margin:0;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color:var(--text);
      padding:
        max(16px, env(safe-area-inset-top))
        16px
        max(16px, env(safe-area-inset-bottom))
        16px;
    }

    /* Container */
    .container{
      width:100%;
      max-width:900px;
      margin:0 auto;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:0 20px 60px rgba(0,0,0,.45);
      overflow:hidden;
    }

    /* Header */
    .header{
      padding:var(--pad);
      border-bottom:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
    }
    h1{
      margin:0 0 6px 0;
      font-size:26px;
      display:flex;
      align-items:center;
      gap:10px;
      line-height:1.2;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      line-height:1.4;
    }

    /* Content */
    .content{
      padding:var(--pad);
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    label{
      font-weight:700;
      margin-bottom:6px;
      display:block;
    }

    textarea{
      width:100%;
      min-height:200px;
      background:var(--panel);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:var(--radius-sm);
      padding:14px;
      font-size:16px; /* wichtig: verhindert iOS Zoom */
      line-height:1.5;
      resize:vertical;
      outline:none;
    }
    textarea:focus{ border-color:var(--primary); }

    .hint{
      color:var(--danger);
      font-size:14px;
      margin-top:6px;
      min-height:18px;
    }

    /* Result */
    .resultWrap{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .resultTitle{
      font-weight:800;
      margin:0;
    }
    .result{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius-sm);
      padding:14px;
      white-space:pre-wrap;
      line-height:1.6;
      font-size:16px;
      min-height:120px;
    }

    /* Buttons bar (desktop) */
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    button{
      border:1px solid var(--border);
      background:#111c2e;
      color:var(--text);
      border-radius:12px;
      height:var(--btn-h);
      padding:0 var(--btn-pad);
      font-weight:800;
      font-size:15px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition: transform .06s ease, opacity .2s ease, border-color .2s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover{ border-color:#2b3b56; }
    button:active{ transform: translateY(1px); }
    button.primary{
      background:var(--primary);
      border-color:transparent;
      color:#fff;
    }
    button:disabled{ opacity:.6; cursor:not-allowed; }

    /* Spinner */
    .spinner{
      display:none;
      text-align:center;
      padding:10px 0 0;
    }
    .loader{
      width:42px;
      height:42px;
      border:4px solid #1f2937;
      border-top:4px solid var(--primary);
      border-radius:50%;
      animation: spin 1s linear infinite;
      margin:0 auto 8px;
    }
    @keyframes spin{ to{ transform:rotate(360deg);} }

    /* Footer */
    .footer{
      padding:14px var(--pad);
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    /* --- MOBILE OPTIMIERUNG --- */
    @media (max-width: 720px){
      :root{
        --pad:16px;
        --btn-h:50px;
        --btn-pad:16px;
      }
      h1{ font-size:22px; }
      textarea{ min-height:220px; }
      .actions{ display:none; } /* wir nutzen sticky bar unten */
      .result{ min-height:140px; }
    }

    /* Sticky action bar (nur mobile) */
    .stickyBar{
      display:none;
    }
    @media (max-width: 720px){
      .stickyBar{
        display:flex;
        position:sticky;
        bottom:0;
        gap:10px;
        padding:12px var(--pad) calc(12px + env(safe-area-inset-bottom));
        background: rgba(17,24,39,.92);
        backdrop-filter: blur(10px);
        border-top:1px solid var(--border);
        z-index:10;
      }
      .stickyBar button{
        flex:1;
        min-width:0;
      }
      .stickyBar button.secondary{
        background:#0f1a2b;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üìÑ briefe-einfach</h1>
      <p class="subtitle">
        F√ºge einen Brief / Beh√∂rden-Text ein ‚Üí klicke <b>Erkl√§ren</b> ‚Üí du bekommst eine einfache Erkl√§rung.
      </p>
    </div>

    <div class="content">
      <div>
        <label for="text">Originaltext</label>
        <textarea id="text" placeholder="Text hier einf√ºgen..."></textarea>

        <div class="actions">
          <button class="primary" id="btnExplain">‚ú® Erkl√§ren</button>
          <button id="btnClear">Leeren</button>
          <button id="btnCopy">Ergebnis kopieren</button>
        </div>

        <div class="hint" id="hint"></div>

        <div class="spinner" id="spinner">
          <div class="loader"></div>
          Erkl√§rung wird erstellt ‚Ä¶
        </div>
      </div>

      <div class="resultWrap">
        <div class="resultTitle">Ergebnis</div>
        <div class="result" id="result"></div>
      </div>
    </div>

    <!-- Sticky bar nur mobile -->
    <div class="stickyBar">
      <button class="primary" id="btnExplainMobile">‚ú® Erkl√§ren</button>
      <button class="secondary" id="btnClearMobile">Leeren</button>
      <button class="secondary" id="btnCopyMobile">Kopieren</button>
    </div>

    <div class="footer">
      Tipp: Sp√§ter kannst du Rate-Limit, API-Key-Schutz & bessere Formatierung erg√§nzen.
    </div>
  </div>

  <script>
    const textEl = document.getElementById("text");
    const resultEl = document.getElementById("result");
    const hintEl = document.getElementById("hint");
    const spinnerEl = document.getElementById("spinner");

    const btnExplain = document.getElementById("btnExplain");
    const btnClear = document.getElementById("btnClear");
    const btnCopy = document.getElementById("btnCopy");

    const btnExplainMobile = document.getElementById("btnExplainMobile");
    const btnClearMobile = document.getElementById("btnClearMobile");
    const btnCopyMobile = document.getElementById("btnCopyMobile");

    function setBusy(isBusy){
      spinnerEl.style.display = isBusy ? "block" : "none";
      [btnExplain, btnExplainMobile].forEach(b => { if (b) b.disabled = isBusy; });
    }

    async function doExplain(){
      hintEl.textContent = "";
      resultEl.textContent = "";

      const text = textEl.value.trim();
      if (!text){
        hintEl.textContent = "Bitte zuerst einen Text eingeben.";
        return;
      }

      setBusy(true);

      try{
        const res = await fetch("/erklaeren", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        if (!res.ok){
          throw new Error("Serverfehler: " + res.status);
        }

        const data = await res.json();
        resultEl.textContent = data.explanation || "Keine Erkl√§rung erhalten.";
      }catch(e){
        hintEl.textContent = "Fehler: Unbekannter Fehler";
      }finally{
        setBusy(false);
      }
    }

    function doClear(){
      textEl.value = "";
      resultEl.textContent = "";
      hintEl.textContent = "";
    }

    async function doCopy(){
      if (!resultEl.textContent) return;
      try{
        await navigator.clipboard.writeText(resultEl.textContent);
      }catch(e){
        // fallback: select + copy
        const range = document.createRange();
        range.selectNodeContents(resultEl);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
        document.execCommand("copy");
        sel.removeAllRanges();
      }
    }

    if (btnExplain) btnExplain.onclick = doExplain;
    if (btnExplainMobile) btnExplainMobile.onclick = doExplain;

    if (btnClear) btnClear.onclick = doClear;
    if (btnClearMobile) btnClearMobile.onclick = doClear;

    if (btnCopy) btnCopy.onclick = doCopy;
    if (btnCopyMobile) btnCopyMobile.onclick = doCopy;
  </script>
</body>
</html>
