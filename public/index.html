<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>briefe-einfach</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,0.06);
      --panel2:rgba(255,255,255,0.08);
      --text:#e8eefc;
      --muted:rgba(232,238,252,0.7);
      --btn:#4c83ff;
      --btn2:rgba(255,255,255,0.14);
      --stroke:rgba(255,255,255,0.10);
      --shadow: 0 20px 50px rgba(0,0,0,0.45);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: radial-gradient(1200px 700px at 20% 20%, rgba(76,131,255,0.25), transparent 60%),
                  radial-gradient(900px 600px at 80% 30%, rgba(76,131,255,0.18), transparent 55%),
                  var(--bg);
      min-height:100vh;
      padding:28px;
    }
    .top{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:16px;
    }
    .logo{
      width:36px;height:36px;border-radius:10px;
      background:linear-gradient(135deg,#4c83ff,#2dd4bf);
      box-shadow:0 10px 20px rgba(76,131,255,0.25);
    }
    h1{font-size:22px;margin:0}
    .subtitle{font-size:12px;color:var(--muted);margin-top:2px}
    .grid{
      display:grid;
      grid-template-columns: 1.35fr 0.85fr;
      gap:18px;
      align-items:start;
      max-width:1200px;
    }
    .card{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      backdrop-filter: blur(10px);
    }
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .chip{
      padding:8px 12px;
      border-radius:999px;
      background:var(--btn2);
      border:1px solid var(--stroke);
      color:var(--text);
      font-size:12px;
    }
    .chip.primary{background:rgba(76,131,255,0.22); border-color:rgba(76,131,255,0.35)}
    textarea{
      width:100%;
      min-height:240px;
      resize:vertical;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,0.25);
      color:var(--text);
      padding:12px;
      outline:none;
      margin-top:10px;
    }
    .btn{
      border:0;
      border-radius:12px;
      padding:10px 14px;
      cursor:pointer;
      color:var(--text);
      background:var(--btn2);
      border:1px solid var(--stroke);
      font-weight:600;
    }
    .btn.primary{background:rgba(76,131,255,0.35); border-color:rgba(76,131,255,0.55)}
    .btn.full{width:100%}
    .muted{color:var(--muted);font-size:12px}
    .result{
      margin-top:12px;
      background:rgba(0,0,0,0.25);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:12px;
      min-height:140px;
      white-space:pre-wrap;
    }
    .right .field{margin-top:10px}
    input{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,0.25);
      color:var(--text);
      outline:none;
    }
    .status{
      margin-top:10px;
      border:1px dashed rgba(255,255,255,0.2);
      border-radius:12px;
      padding:10px;
      background:rgba(0,0,0,0.18);
      font-size:12px;
      white-space:pre-wrap;
      min-height:44px;
    }
    .footer{
      margin-top:14px;
      text-align:center;
      color:rgba(232,238,252,0.45);
      font-size:11px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>

  <div class="top">
    <div class="logo"></div>
    <div>
      <h1>briefe-einfach</h1>
      <div class="subtitle">Briefe erklären & übersetzen (MVP) – stabiler Server, UI wieder "normal".</div>
    </div>
    <div style="margin-left:auto" class="muted" id="serverStatus">Status: lade…</div>
  </div>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="row">
        <span class="chip primary">Brief erklären</span>
        <span class="chip">Übersetzen</span>
        <span class="muted" style="margin-left:auto">Text einfügen → „Erklären“ drücken.</span>
      </div>

      <div class="muted" style="margin-top:10px">Brieftext</div>
      <textarea id="letter" placeholder="Brief hier einfügen…"></textarea>

      <div class="row" style="margin-top:10px">
        <button class="btn primary" onclick="doExplain()">Erklären</button>
        <button class="btn" onclick="copyResult()">Ergebnis kopieren</button>
        <button class="btn" onclick="clearAll()">Leeren</button>
      </div>

      <div class="muted" style="margin-top:12px">Ergebnis</div>
      <div class="result" id="result">—</div>

      <div class="footer">MVP • Railway • Cookie Sessions • UI wieder produktiv</div>
    </div>

    <!-- RIGHT -->
    <div class="card right">
      <div class="row" style="justify-content:space-between">
        <div style="font-weight:700">Login</div>
        <div class="chip" id="loginChip">Nicht eingeloggt</div>
      </div>

      <div class="field">
        <div class="muted">E-Mail</div>
        <input id="email" placeholder="name@mail.de" />
      </div>
      <div class="field">
        <div class="muted">Passwort</div>
        <input id="pw" type="password" placeholder="••••••••" />
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn" onclick="register()">Registrieren</button>
        <button class="btn primary" onclick="login()">Login</button>
        <button class="btn" onclick="logout()">Logout</button>
      </div>

      <div class="muted" style="margin-top:10px">Status</div>
      <div class="status" id="authStatus">—</div>

      <div class="muted" style="margin-top:12px">Abo</div>
      <div class="muted">Startet Stripe Checkout (monatlich). Danach schalten wir „Pro“ frei.</div>
      <button class="btn primary full" style="margin-top:10px" onclick="startCheckout()">Abo starten (Stripe)</button>

      <div class="status" id="billingStatus" style="margin-top:10px">—</div>
    </div>
  </div>

<script>
async function api(url, body){
  const r = await fetch(url, {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify(body || {})
  });
  let data = null;
  try { data = await r.json(); } catch(e){ data = { ok:false, error:"Keine JSON Antwort", status:r.status }; }
  return { status: r.status, data };
}

function setText(id, obj){
  document.getElementById(id).textContent =
    typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
}

async function refreshMe(){
  const r = await api("/auth/me");
  const d = await r.json();
  document.getElementById("serverStatus").textContent = "Status: ok";
  document.getElementById("loginChip").textContent = d.loggedIn ? "Eingeloggt" : "Nicht eingeloggt";
  if (d.loggedIn) document.getElementById("authStatus").textContent = JSON.stringify(d, null, 2);
}

async function register(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("pw").value;
  const {data} = await api("/auth/register", { email, password });
  setText("authStatus", data);
  await refreshMe();
}

async function login(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("pw").value;
  const {data} = await api("/auth/login", { email, password });
  setText("authStatus", data);
  await refreshMe();
}

async function logout(){
  const {data} = await api("/auth/logout", {});
  setText("authStatus", data);
  await refreshMe();
}

async function doExplain(){
  const text = document.getElementById("letter").value;
  const {data} = await api("/api/explain", { text });
  setText("result", data.result || data.error || data);
}

function copyResult(){
  const t = document.getElementById("result").textContent;
  navigator.clipboard.writeText(t);
}

function clearAll(){
  document.getElementById("letter").value = "";
  document.getElementById("result").textContent = "—";
}

async function startCheckout(){
  const {data, status} = await api("/billing/checkout", {});
  if (data?.url) {
    setText("billingStatus", { ok:true, redirect:data.url });
    window.location.href = data.url;
  } else {
    setText("billingStatus", { status, ...data });
  }
}

refreshMe();
</script>
const API_BASE = "";

async function api(path, options = {}) {
  return fetch(path, {
    credentials: "include",
    headers: {
      "Content-Type": "application/json",
      ...(options.headers || {})
    },
    ...options
  });
}


</body>
</html>
