<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>briefe-einfach</title>

  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.09);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.75);
      --line:rgba(255,255,255,.12);
      --ok:#30d158;
      --warn:#ffd60a;
      --bad:#ff453a;
      --btn:#3b82f6;
      --btn2:rgba(255,255,255,.08);
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(59,130,246,.35), transparent 60%),
        radial-gradient(800px 500px at 90% 10%, rgba(168,85,247,.25), transparent 55%),
        var(--bg);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .wrap{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }

    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding:18px 18px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo{
      width:34px;height:34px;
      border-radius:10px;
      background:linear-gradient(135deg, rgba(59,130,246,.95), rgba(168,85,247,.9));
      display:grid;place-items:center;
      font-weight:800;
    }
    .title{
      font-size:22px;
      font-weight:800;
      margin:0;
      line-height:1.1;
    }
    .subtitle{
      margin:2px 0 0;
      color:var(--muted);
      font-size:13px;
    }
    .cardBody{ padding:16px 18px 18px; }

    label{display:block; font-size:13px; color:var(--muted); margin:10px 0 6px;}
    textarea{
      width:100%;
      min-height:220px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:var(--text);
      padding:12px;
      resize:vertical;
      outline:none;
    }
    textarea:focus{border-color:rgba(59,130,246,.7)}

    .btnRow{ display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    button{
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:700;
      cursor:pointer;
      color:var(--text);
      background:var(--btn2);
      border:1px solid var(--line);
    }
    button.primary{
      background:linear-gradient(135deg, rgba(59,130,246,.95), rgba(59,130,246,.65));
      border-color:rgba(59,130,246,.6);
    }
    button:disabled{opacity:.45; cursor:not-allowed}

    .result{
      margin-top:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      padding:12px;
      min-height:170px;
      white-space:pre-wrap;
    }

    .hint{ margin-top:10px; font-size:12px; color:var(--muted); }

    /* Right panel */
    .sideBox{
      padding:16px 18px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .statusRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.16);
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--muted);
    }
    .pill.ok{ color:var(--ok); border-color:rgba(48,209,88,.35); }
    .pill.bad{ color:var(--bad); border-color:rgba(255,69,58,.35); }

    .divider{ height:1px; background:var(--line); margin:4px 0; }

    /* Modal */
    .modalBackdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:10;
    }
    .modal{
      width:min(420px, 100%);
      background:rgba(15,23,42,.92);
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .modalHead{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalHead h3{ margin:0; font-size:18px; }
    .modalBody{ padding:14px 16px 16px; }
    .err{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(255,69,58,.14);
      border:1px solid rgba(255,69,58,.22);
      color:rgba(255,255,255,.92);
      display:none;
    }

    .twoBtns{
      display:flex; gap:10px; margin-top:12px;
    }
    .twoBtns button{ flex:1; }

    /* Mobile Optimierung */
    @media (max-width: 880px){
      .wrap{ grid-template-columns: 1fr; }
      textarea{ min-height: 180px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- Left: Explain -->
    <section class="card">
      <div class="cardHeader">
        <div class="logo">üìÑ</div>
        <div>
          <p class="title">briefe-einfach</p>
          <p class="subtitle">F√ºge einen Brief/Beh√∂rden-Text ein ‚Üí klicke <b>Erkl√§ren</b> ‚Üí du bekommst eine einfache Erkl√§rung.</p>
        </div>
      </div>

      <div class="cardBody">
        <label for="input">Originaltext</label>
        <textarea id="input" placeholder="Text hier einf√ºgen..."></textarea>

        <div class="btnRow">
          <button id="btnExplain" class="primary">‚ú® Erkl√§ren</button>
          <button id="btnClear">üßπ Leeren</button>
          <button id="btnCopy">üìã Ergebnis kopieren</button>
        </div>

        <label>Ergebnis</label>
        <div id="output" class="result"></div>

        <div class="hint">Tipp: Sp√§ter kannst du Rate-Limit, API-Key-Schutz & bessere Formatierung erg√§nzen.</div>
      </div>
    </section>

    <!-- Right: Account + Status -->
    <aside class="card">
      <div class="cardHeader">
        <div class="logo">üë§</div>
        <div>
          <p class="title">Account</p>
          <p class="subtitle">Login / Registrierung + Status (Demo)</p>
        </div>
      </div>

      <div class="sideBox">
        <div class="statusRow">
          <div>
            <div style="font-weight:800;">Backend</div>
            <div style="color:var(--muted); font-size:12px;">/health</div>
          </div>
          <span id="pillBackend" class="pill">pr√ºfe‚Ä¶</span>
        </div>

        <div class="statusRow">
          <div>
            <div style="font-weight:800;">Login</div>
            <div id="who" style="color:var(--muted); font-size:12px;">nicht eingeloggt</div>
          </div>
          <button id="btnOpenAuth" class="primary">Login / Registrieren</button>
        </div>

        <div class="divider"></div>

        <div class="statusRow">
          <div>
            <div style="font-weight:800;">Abo (sp√§ter Stripe)</div>
            <div style="color:var(--muted); font-size:12px;">Noch Demo ‚Äì kommt als N√§chstes</div>
          </div>
          <span class="pill">Demo</span>
        </div>

        <div class="hint">
          Wichtig: √ñffne diese App immer √ºber <b>https://‚Ä¶railway.app</b> oder <b>http://localhost:3000</b>.
          <br/>Wenn du sie als Datei (<b>file:///‚Ä¶</b>) √∂ffnest, blockt der Browser alle API-Calls (CORS).
        </div>
      </div>
    </aside>

  </div>

  <!-- Auth Modal -->
  <div class="modalBackdrop" id="authBackdrop">
    <div class="modal">
      <div class="modalHead">
        <h3 id="authTitle">Registrieren</h3>
        <button id="btnCloseAuth" title="Schlie√üen">‚úñ</button>
      </div>
      <div class="modalBody">
        <label>E-Mail</label>
        <input id="email" type="email" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(0,0,0,.18);color:var(--text);outline:none;" placeholder="name@mail.de" />

        <label>Passwort</label>
        <input id="pass" type="password" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:rgba(0,0,0,.18);color:var(--text);outline:none;" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />

        <div id="authErr" class="err">Fehler</div>

        <div class="twoBtns">
          <button id="btnDoAuth" class="primary">Registrieren</button>
          <button id="btnSwitchMode">Schon ein Konto? Login</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ Ganz wichtig: niemals file:/// benutzen
    if (location.protocol === "file:") {
      document.body.innerHTML =
        "<div style='max-width:720px;background:rgba(255,69,58,.15);border:1px solid rgba(255,69,58,.3);padding:18px;border-radius:16px;color:#fff;font-family:system-ui'>" +
        "<h2>‚ùå Bitte nicht per Doppelklick √∂ffnen</h2>" +
        "<p>Du hast die App als Datei ge√∂ffnet (<b>file:///‚Ä¶</b>). Dadurch blockt der Browser alle API-Calls (CORS).</p>" +
        "<p><b>So geht‚Äôs richtig:</b><br>1) Lokal: <b>npm start</b> ‚Üí dann <b>http://localhost:3000</b><br>2) Online: Railway-URL √∂ffnen (<b>https://‚Ä¶railway.app</b>)</p>" +
        "</div>";
      throw new Error("App wurde √ºber file:// ge√∂ffnet");
    }

    // --- UI helpers ---
    const $ = (id) => document.getElementById(id);

    const output = $("output");
    const input  = $("input");

    const btnExplain = $("btnExplain");
    const btnClear   = $("btnClear");
    const btnCopy    = $("btnCopy");

    const pillBackend = $("pillBackend");
    const who = $("who");

    const authBackdrop = $("authBackdrop");
    const btnOpenAuth = $("btnOpenAuth");
    const btnCloseAuth = $("btnCloseAuth");
    const btnSwitchMode = $("btnSwitchMode");
    const btnDoAuth = $("btnDoAuth");
    const authTitle = $("authTitle");
    const authErr = $("authErr");
    const email = $("email");
    const pass = $("pass");

    let mode = "register"; // register | login
    let token = localStorage.getItem("token") || "";

    function setErr(msg){
      authErr.style.display = msg ? "block" : "none";
      authErr.textContent = msg || "";
    }

    function openAuth(){
      authBackdrop.style.display = "flex";
      setErr("");
      updateAuthUI();
    }
    function closeAuth(){
      authBackdrop.style.display = "none";
      setErr("");
    }
    function updateAuthUI(){
      if (mode === "register"){
        authTitle.textContent = "Registrieren";
        btnDoAuth.textContent = "Registrieren";
        btnSwitchMode.textContent = "Schon ein Konto? Login";
      } else {
        authTitle.textContent = "Login";
        btnDoAuth.textContent = "Login";
        btnSwitchMode.textContent = "Noch kein Konto? Registrieren";
      }
    }

    async function api(path, options={}){
      const headers = options.headers || {};
      headers["Content-Type"] = "application/json";
      if (token) headers["Authorization"] = "Bearer " + token;
      const res = await fetch(path, { ...options, headers });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data.error || ("HTTP " + res.status));
      return data;
    }

    async function checkBackend(){
      try{
        const res = await fetch("/health");
        const data = await res.json();
        if (data.ok){
          pillBackend.className = "pill ok";
          pillBackend.textContent = "online";
        } else {
          throw new Error("not ok");
        }
      } catch(e){
        pillBackend.className = "pill bad";
        pillBackend.textContent = "offline";
      }
    }

    async function refreshMe(){
      if (!token){
        who.textContent = "nicht eingeloggt";
        return;
      }
      try{
        const me = await api("/auth/me");
        who.textContent = "eingeloggt (Demo)";
      } catch(e){
        token = "";
        localStorage.removeItem("token");
        who.textContent = "nicht eingeloggt";
      }
    }

    // --- Explain Demo (noch ohne KI, sp√§ter ersetzen wir das) ---
    function simpleExplain(text){
      if (!text.trim()) return "Bitte erst einen Text eingeben.";
      // Minimal-Demo: sehr einfache Umschreibung
      return [
        "Das ist eine einfache Erkl√§rung:",
        "",
        "‚Ä¢ Der Brief richtet sich h√∂flich an Sie.",
        "‚Ä¢ Es geht darum, Informationen verst√§ndlich zu erkl√§ren.",
        "‚Ä¢ Sie sollten den Text genau lesen und ggf. reagieren."
      ].join("\n");
    }

    btnExplain.addEventListener("click", async () => {
      output.textContent = simpleExplain(input.value);
    });

    btnClear.addEventListener("click", () => {
      input.value = "";
      output.textContent = "";
    });

    btnCopy.addEventListener("click", async () => {
      const t = output.textContent || "";
      if (!t.trim()) return;
      await navigator.clipboard.writeText(t);
      btnCopy.textContent = "‚úÖ Kopiert";
      setTimeout(()=> btnCopy.textContent = "üìã Ergebnis kopieren", 900);
    });

    btnOpenAuth.addEventListener("click", openAuth);
    btnCloseAuth.addEventListener("click", closeAuth);
    authBackdrop.addEventListener("click", (e) => {
      if (e.target === authBackdrop) closeAuth();
    });

    btnSwitchMode.addEventListener("click", () => {
      mode = (mode === "register") ? "login" : "register";
      setErr("");
      updateAuthUI();
    });

    btnDoAuth.addEventListener("click", async () => {
      setErr("");
      const em = email.value.trim();
      const pw = pass.value.trim();
      if (!em || !pw) return setErr("Bitte E-Mail und Passwort eingeben.");

      try{
        if (mode === "register"){
          await api("/auth/register", { method:"POST", body: JSON.stringify({ email: em, password: pw }) });
          // Nach Registrierung direkt Login
          const r = await api("/auth/login", { method:"POST", body: JSON.stringify({ email: em, password: pw }) });
          token = r.token;
          localStorage.setItem("token", token);
          await refreshMe();
          closeAuth();
        } else {
          const r = await api("/auth/login", { method:"POST", body: JSON.stringify({ email: em, password: pw }) });
          token = r.token;
          localStorage.setItem("token", token);
          await refreshMe();
          closeAuth();
        }
      } catch(e){
        setErr(e.message || "Unbekannter Fehler");
      }
    });

    // init
    checkBackend();
    refreshMe();
  </script>
</body>
</html>
