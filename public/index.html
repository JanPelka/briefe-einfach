<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>briefe-einfach</title>
  <style>
    body { font-family: sans-serif; background:#111; color:#fff; padding:40px }
    input, button { padding:8px; margin:5px }
    button { cursor:pointer }
    pre { background:#222; padding:10px }
  </style>
</head>
<body>

<h2>briefe-einfach – Cookie Login</h2>

<input id="email" placeholder="E-Mail">
<input id="password" type="password" placeholder="Passwort">

<br>
<button onclick="register()">Registrieren</button>
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>

<h3>Status</h3>
<pre id="status"></pre>

<button onclick="check()">/auth/me prüfen</button>

<h3>Abo</h3>
<button onclick="checkout()">Abo starten (Stripe)</button>

<script>
async function register() {
  const res = await fetch("/auth/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: email.value,
      password: password.value
    })
  });
  status.textContent = await res.text();
}

async function login() {
  const res = await fetch("/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    credentials: "include",
    body: JSON.stringify({
      email: email.value,
      password: password.value
    })
  });
  status.textContent = await res.text();
}

async function logout() {
  const res = await fetch("/auth/logout", {
    method: "POST",
    credentials: "include"
  });
  status.textContent = await res.text();
}

async function check() {
  const res = await fetch("/auth/me", {
    credentials: "include"
  });
  status.textContent = JSON.stringify(await res.json(), null, 2);
}

async function checkout() {
  const res = await fetch("/create-checkout-session", {
    method: "POST",
    credentials: "include"
  });
  const data = await res.json();
  if (data.url) window.location = data.url;
  else status.textContent = JSON.stringify(data, null, 2);
}
</script>

</body>
</html>
