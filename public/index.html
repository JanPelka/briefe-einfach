<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>briefe-einfach</title>
    <style>
      :root {
        --bg: #0b1020;
        --card: rgba(255, 255, 255, 0.07);
        --border: rgba(255, 255, 255, 0.12);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.70);
        --btn: rgba(255, 255, 255, 0.10);
        --btn2: rgba(255, 255, 255, 0.16);
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: radial-gradient(1200px 600px at 20% 0%, #1b2a6b 0%, transparent 60%),
          radial-gradient(800px 500px at 90% 10%, #4b1b6b 0%, transparent 55%),
          var(--bg);
        color: var(--text);
      }

      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 22px 14px 60px;
      }

      .header {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 14px;
      }

      .logo {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        background: rgba(255,255,255,0.12);
        display: grid;
        place-items: center;
        border: 1px solid var(--border);
      }

      h1 {
        font-size: 26px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      .subtitle {
        margin: 6px 0 18px;
        color: var(--muted);
        line-height: 1.35;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
      }

      @media (min-width: 900px) {
        .grid { grid-template-columns: 1fr 1fr; }
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 14px;
        backdrop-filter: blur(10px);
      }

      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 6px;
      }

      textarea {
        width: 100%;
        min-height: 220px;
        resize: vertical;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0,0,0,0.18);
        color: var(--text);
        outline: none;
        font-size: 14px;
        line-height: 1.45;
      }

      .btnRow {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      button {
        border: 1px solid var(--border);
        background: var(--btn);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
      }
      button:hover { background: var(--btn2); }

      button.primary {
        background: rgba(120, 110, 255, 0.35);
        border-color: rgba(120, 110, 255, 0.55);
      }
      button.primary:hover {
        background: rgba(120, 110, 255, 0.48);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .resultBox {
        white-space: pre-wrap;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(0,0,0,0.18);
        padding: 12px;
        min-height: 220px;
        font-size: 14px;
        line-height: 1.45;
      }

      .hint {
        margin-top: 10px;
        font-size: 12px;
        color: var(--muted);
      }

      .error {
        margin-top: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(255, 120, 120, 0.45);
        background: rgba(255, 120, 120, 0.12);
        color: rgba(255, 210, 210, 0.95);
        display: none;
      }

      /* Spinner */
      .spinner {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid rgba(255,255,255,0.35);
        border-top-color: rgba(255,255,255,0.95);
        display: inline-block;
        animation: spin 0.8s linear infinite;
        vertical-align: -3px;
        margin-right: 8px;
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      .paid {
        margin: 10px 0 0;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid rgba(120, 255, 160, 0.35);
        background: rgba(120, 255, 160, 0.12);
        color: rgba(220, 255, 230, 0.95);
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="header">
        <div class="logo">üìÑ</div>
        <div>
          <h1>briefe-einfach</h1>
          <div class="subtitle">
            F√ºge einen Brief/Beh√∂rden-Text ein ‚Üí klicke <b>Erkl√§ren</b> ‚Üí du bekommst eine einfache Erkl√§rung.
          </div>
        </div>
      </div>

      <div class="paid" id="paidBox">‚úÖ Zahlung erkannt. Danke! (Demo-Hinweis: Freischaltung bauen wir als n√§chstes.)</div>

      <div class="grid">
        <div class="card">
          <label for="inputText">Originaltext</label>
          <textarea id="inputText" placeholder="Text hier einf√ºgen..."></textarea>

          <div class="btnRow">
            <button class="primary" id="btnExplain">
              <span id="btnExplainIcon">‚ú®</span>
              <span id="btnExplainText">Erkl√§ren</span>
            </button>

            <button id="btnClear">Leeren</button>

            <button id="btnCopy" disabled>Ergebnis kopieren</button>

            <button id="btnPay">üí≥ Pro kaufen (5 ‚Ç¨)</button>
          </div>

          <div class="error" id="errorBox"></div>

          <div class="hint">
            Tipp: Als n√§chstes bauen wir Rate-Limit, API-Key Schutz, bessere Formatierung und echte KI-Antworten ein.
          </div>
        </div>

        <div class="card">
          <label>Ergebnis</label>
          <div class="resultBox" id="resultBox"></div>
        </div>
      </div>
    </div>

    <script>
      const input = document.getElementById("inputText");
      const resultBox = document.getElementById("resultBox");
      const errorBox = document.getElementById("errorBox");
      const paidBox = document.getElementById("paidBox");

      const btnExplain = document.getElementById("btnExplain");
      const btnExplainText = document.getElementById("btnExplainText");
      const btnExplainIcon = document.getElementById("btnExplainIcon");

      const btnClear = document.getElementById("btnClear");
      const btnCopy = document.getElementById("btnCopy");
      const btnPay = document.getElementById("btnPay");

      function setError(msg) {
        if (!msg) {
          errorBox.style.display = "none";
          errorBox.textContent = "";
          return;
        }
        errorBox.style.display = "block";
        errorBox.textContent = "‚ùå " + msg;
      }

      function setLoading(isLoading) {
        btnExplain.disabled = isLoading;
        btnClear.disabled = isLoading;
        btnPay.disabled = isLoading;

        if (isLoading) {
          btnExplainIcon.innerHTML = '<span class="spinner"></span>';
          btnExplainText.textContent = "Bitte warten‚Ä¶";
        } else {
          btnExplainIcon.textContent = "‚ú®";
          btnExplainText.textContent = "Erkl√§ren";
        }
      }

      async function explainText() {
        setError("");
        const text = (input.value || "").trim();
        if (!text) {
          setError("Bitte zuerst einen Text eingeben.");
          return;
        }

        setLoading(true);
        resultBox.textContent = "";

        try {
          const res = await fetch("/erklaeren", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text })
          });

          const data = await res.json().catch(() => ({}));

          if (!res.ok) {
            throw new Error(data.error || "Unbekannter Fehler");
          }

          resultBox.textContent = data.result || "";
          btnCopy.disabled = !data.result;
        } catch (err) {
          setError(err.message || "Unbekannter Fehler");
          btnCopy.disabled = true;
        } finally {
          setLoading(false);
        }
      }

      function clearAll() {
        setError("");
        input.value = "";
        resultBox.textContent = "";
        btnCopy.disabled = true;
      }

      async function buyPro() {
        setError("");
        setLoading(true);

        try {
          const res = await fetch("/create-checkout-session", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({})
          });

          const data = await res.json().catch(() => ({}));
          if (!res.ok) throw new Error(data.error || "Stripe Fehler");

          if (!data.url) throw new Error("Keine Checkout-URL erhalten.");
          window.location.href = data.url;
        } catch (err) {
          setError(err.message || "Stripe Fehler");
        } finally {
          setLoading(false);
        }
      }

      btnExplain.addEventListener("click", explainText);
      btnClear.addEventListener("click", clearAll);

      btnCopy.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(resultBox.textContent || "");
        } catch (e) {
          setError("Kopieren ging nicht (Browser-Rechte).");
        }
      });

      btnPay.addEventListener("click", buyPro);

      // Payment-Status in URL anzeigen (?paid=1)
      const params = new URLSearchParams(window.location.search);
      if (params.get("paid") === "1") {
        paidBox.style.display = "block";
      }
    </script>
  </body>
</html>
